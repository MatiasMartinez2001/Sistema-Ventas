<div class="container my-5">
  <div class="row mb-4">
    <div class="col-12">
      <h1 class="mb-3">üìä Reportes y Estad√≠sticas</h1>
      <p class="text-muted">Visualiza y analiza el rendimiento de tu negocio</p>
    </div>
  </div>

  <!-- Filtros de Fecha -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-light">
          <h5 class="mb-0">üîç Filtros de Fecha</h5>
        </div>
        <div class="card-body">
          <div class="row align-items-end">
            <div class="col-md-4">
              <label for="fechaInicio" class="form-label">Fecha Inicio</label>
              <input 
                type="date" 
                class="form-control" 
                id="fechaInicio"
                [(ngModel)]="fechaInicio">
            </div>
            <div class="col-md-4">
              <label for="fechaFin" class="form-label">Fecha Fin</label>
              <input 
                type="date" 
                class="form-control" 
                id="fechaFin"
                [(ngModel)]="fechaFin">
            </div>
            <div class="col-md-4">
              <button 
                class="btn btn-primary me-2"
                (click)="aplicarFiltros()">
                Aplicar Filtros
              </button>
              <button 
                class="btn btn-secondary"
                (click)="limpiarFiltros()">
                Limpiar
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Estad√≠sticas Generales -->
  <div class="row mb-4">
    <div class="col-12">
      <h3 class="mb-3">üìà Estad√≠sticas Generales</h3>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card text-center border-primary">
        <div class="card-body">
          <h5 class="card-title text-primary">üí∞ Total de Ingresos</h5>
          <h2 class="text-primary">{{ formatearPrecio(estadisticas.totalIngresos) }}</h2>
          <small class="text-muted">En el per√≠odo seleccionado</small>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card text-center border-success">
        <div class="card-body">
          <h5 class="card-title text-success">üì¶ Total de Pedidos</h5>
          <h2 class="text-success">{{ estadisticas.totalPedidos }}</h2>
          <small class="text-muted">Pedidos realizados</small>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card text-center border-info">
        <div class="card-body">
          <h5 class="card-title text-info">üìä Promedio por Pedido</h5>
          <h2 class="text-info">{{ formatearPrecio(estadisticas.promedioPedido) }}</h2>
          <small class="text-muted">Ticket promedio</small>
        </div>
      </div>
    </div>
    <div class="col-md-3 mb-3">
      <div class="card text-center border-warning">
        <div class="card-body">
          <h5 class="card-title text-warning">üõí √çtems Vendidos</h5>
          <h2 class="text-warning">{{ estadisticas.totalItemsVendidos }}</h2>
          <small class="text-muted">Unidades totales</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Productos M√°s Vendidos -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0">üèÜ Top 10 Productos M√°s Vendidos</h5>
        </div>
        <div class="card-body">
          <div *ngIf="productosMasVendidos.length === 0" class="alert alert-info">
            No hay productos vendidos en el per√≠odo seleccionado.
          </div>
          <div *ngIf="productosMasVendidos.length > 0" class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-dark">
                <tr>
                  <th>#</th>
                  <th>Producto</th>
                  <th>Categor√≠a</th>
                  <th>Cantidad Vendida</th>
                  <th>Ingresos Generados</th>
                  <th>Precio Unitario</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of productosMasVendidos; let i = index">
                  <td>
                    <span class="badge bg-primary">{{ i + 1 }}</span>
                  </td>
                  <td>
                    <strong>{{ item.producto.nombre }}</strong>
                    <br>
                    <small class="text-muted">{{ item.producto.descripcion }}</small>
                  </td>
                  <td>
                    <span class="badge bg-secondary">{{ item.producto.categoria || 'Sin categor√≠a' }}</span>
                  </td>
                  <td>
                    <span class="badge bg-success fs-6">{{ item.cantidadVendida }} unidades</span>
                  </td>
                  <td>
                    <strong class="text-success">{{ formatearPrecio(item.ingresosGenerados) }}</strong>
                  </td>
                  <td>{{ formatearPrecio(item.producto.precio) }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Clientes M√°s Activos -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-success text-white">
          <h5 class="mb-0">üë• Top 10 Clientes M√°s Activos</h5>
        </div>
        <div class="card-body">
          <div *ngIf="clientesMasActivos.length === 0" class="alert alert-info">
            No hay clientes con pedidos en el per√≠odo seleccionado.
          </div>
          <div *ngIf="clientesMasActivos.length > 0" class="table-responsive">
            <table class="table table-striped table-hover">
              <thead class="table-dark">
                <tr>
                  <th>#</th>
                  <th>Cliente</th>
                  <th>Email</th>
                  <th>Tel√©fono</th>
                  <th>Cantidad de Pedidos</th>
                  <th>Total Gastado</th>
                  <th>Promedio por Pedido</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let item of clientesMasActivos; let i = index">
                  <td>
                    <span class="badge bg-success">{{ i + 1 }}</span>
                  </td>
                  <td>
                    <strong>{{ item.cliente.nombre }}</strong>
                  </td>
                  <td>
                    <small>{{ item.cliente.email }}</small>
                  </td>
                  <td>
                    <small>{{ item.cliente.telefono }}</small>
                  </td>
                  <td>
                    <span class="badge bg-info">{{ item.cantidadPedidos }} pedidos</span>
                  </td>
                  <td>
                    <strong class="text-success">{{ formatearPrecio(item.totalGastado) }}</strong>
                  </td>
                  <td>
                    {{ formatearPrecio(item.totalGastado / item.cantidadPedidos) }}
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Resumen de Pedidos por Estado -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-info text-white">
          <h5 class="mb-0">üìã Resumen de Pedidos por Estado</h5>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md-4 mb-3" *ngFor="let estado of obtenerEstadosUnicos()">
              <div class="card border-info">
                <div class="card-body text-center">
                  <h6 class="card-title">{{ estado }}</h6>
                  <h3 class="text-info">{{ contarPedidosPorEstado(estado) }}</h3>
                  <small class="text-muted">pedidos</small>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Gr√°fico de Ventas por D√≠a (Tabla) -->
  <div class="row">
    <div class="col-12">
      <div class="card">
        <div class="card-header bg-warning text-dark">
          <h5 class="mb-0">üìÖ Ventas por D√≠a</h5>
        </div>
        <div class="card-body">
          <div *ngIf="pedidosFiltrados.length === 0" class="alert alert-warning">
            No hay pedidos en el per√≠odo seleccionado.
          </div>
          <div *ngIf="pedidosFiltrados.length > 0" class="table-responsive">
            <table class="table table-sm table-striped">
              <thead class="table-light">
                <tr>
                  <th>Fecha</th>
                  <th>Cantidad de Pedidos</th>
                  <th>Total de Ingresos</th>
                  <th>√çtems Vendidos</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let dia of obtenerVentasPorDia()">
                  <td><strong>{{ dia.fecha }}</strong></td>
                  <td>
                    <span class="badge bg-primary">{{ dia.cantidadPedidos }}</span>
                  </td>
                  <td>
                    <strong class="text-success">{{ formatearPrecio(dia.totalIngresos) }}</strong>
                  </td>
                  <td>{{ dia.itemsVendidos }} √≠tems</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
